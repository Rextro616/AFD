from afd import AFD

def reportOccurrences(afd, text):
    occurrences = afd.run(text)
    return occurrences

def reportOccurrencesTable(afd, loops):
    occurrences = []
    for index, loop in loops:
        if afd.runTables(loop):
            occurrences.append({
                    'text': loop,
                    'indice': index,
                })
    return occurrences

def main(content, extension):
    states = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27} 
    alphabet = {"A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z",
    "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z",
    "0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
    "!", "\"", "#", "$", "%", "&", "'", "(", ")", "*", "+", ",", "-", ".", "/", ":", ";", "<", "=", ">", "?", "@", "[", "\\", "]", "^", "_", "`", "{", "|", "}", "~",
    " ", "\n", "\t"} 
    transitions = {
        #Do while loop
        (1, 'd'): 2, 
        (2, 'o'): 3, 
        (3, ' '): 3,
        (3, '\n'): 3,
        (3, '\t'): 3,
        (3, '{'): 4,
        (4, "A"): 4, 
        (4, "B"): 4, 
        (4, "C"): 4, 
        (4, "D"): 4, 
        (4, "E"): 4, 
        (4, "F"): 4, 
        (4, "G"): 4, 
        (4, "H"): 4, 
        (4, "I"): 4,
        (4, "J"): 4, 
        (4, "K"): 4, 
        (4, "L"): 4, 
        (4, "M"): 4, 
        (4, "N"): 4, 
        (4, "O"): 4, 
        (4, "P"): 4, 
        (4, "Q"): 4, 
        (4, "R"): 4,
        (4, "S"): 4, 
        (4, "T"): 4, 
        (4, "U"): 4, 
        (4, "V"): 4, 
        (4, "W"): 4, 
        (4, "X"): 4, 
        (4, "Y"): 4, 
        (4, "Z"): 4,
        (4, "a"): 4, 
        (4, "b"): 4, 
        (4, "c"): 4, 
        (4, "d"): 4, 
        (4, "e"): 4, 
        (4, "f"): 4, 
        (4, "g"): 4, 
        (4, "h"): 4, 
        (4, "i"): 4,
        (4, "j"): 4, 
        (4, "k"): 4, 
        (4, "l"): 4, 
        (4, "m"): 4, 
        (4, "n"): 4, 
        (4, "o"): 4, 
        (4, "p"): 4, 
        (4, "q"): 4, 
        (4, "r"): 4,
        (4, "s"): 4, 
        (4, "t"): 4, 
        (4, "u"): 4, 
        (4, "v"): 4, 
        (4, "w"): 4, 
        (4, "x"): 4, 
        (4, "y"): 4, 
        (4, "z"): 4,
        (4, "0"): 4, 
        (4, "1"): 4, 
        (4, "2"): 4, 
        (4, "3"): 4, 
        (4, "4"): 4, 
        (4, "5"): 4, 
        (4, "6"): 4, 
        (4, "7"): 4, 
        (4, "8"): 4, 
        (4, "9"): 4,
        (4, "!"): 4, 
        (4, "\""): 4, 
        (4, "#"): 4, 
        (4, "$"): 4, 
        (4, "%"): 4, 
        (4, "&"): 4, 
        (4, "'"): 4, 
        (4, "("): 4, 
        (4, ")"): 4,
        (4, "*"): 4, 
        (4, "+"): 4, 
        (4, ","): 4, 
        (4, "-"): 4, 
        (4, "."): 4, 
        (4, "/"): 4, 
        (4, ":"): 4, 
        (4, ";"): 4, 
        (4, "<"): 4, 
        (4, "="): 4, 
        (4, ">"): 4, 
        (4, "?"): 4, 
        (4, "@"): 4, 
        (4, "["): 4, 
        (4, "\\"): 4, 
        (4, "]"): 4, 
        (4, "^"): 4, 
        (4, "_"): 4, 
        (4, "`"): 4, 
        (4, "|"): 4, 
        (4, "~"): 4,
        (4, " "): 4, 
        (4, "\n"): 4,
        (4, '\t'): 4,
        (4, "}"): 5,
        (5, ' '): 5, 
        (5, '\n'): 5,
        (5, '\t'): 5,
        (5, 'w'): 6,
        (6, 'h'): 7,
        (7, 'i'): 8,
        (8, 'l'): 9,
        (9, 'e'): 10,
        (10, ' '): 10, 
        (10, '\n'): 10,
        (10, '\t'): 10,
        (10, '('): 11,
        (11, "A"): 11, 
        (11, "B"): 11, 
        (11, "C"): 11, 
        (11, "D"): 11, 
        (11, "E"): 11, 
        (11, "F"): 11, 
        (11, "G"): 11, 
        (11, "H"): 11, 
        (11, "I"): 11,
        (11, "J"): 11, 
        (11, "K"): 11, 
        (11, "L"): 11, 
        (11, "M"): 11, 
        (11, "N"): 11, 
        (11, "O"): 11, 
        (11, "P"): 11, 
        (11, "Q"): 11, 
        (11, "R"): 11,
        (11, "S"): 11, 
        (11, "T"): 11, 
        (11, "U"): 11, 
        (11, "V"): 11, 
        (11, "W"): 11, 
        (11, "X"): 11, 
        (11, "Y"): 11, 
        (11, "Z"): 11,
        (11, "a"): 11, 
        (11, "b"): 11, 
        (11, "c"): 11, 
        (11, "d"): 11, 
        (11, "e"): 11, 
        (11, "f"): 11, 
        (11, "g"): 11, 
        (11, "h"): 11, 
        (11, "i"): 11,
        (11, "j"): 11, 
        (11, "k"): 11, 
        (11, "l"): 11, 
        (11, "m"): 11, 
        (11, "n"): 11, 
        (11, "o"): 11, 
        (11, "p"): 11, 
        (11, "q"): 11, 
        (11, "r"): 11,
        (11, "s"): 11, 
        (11, "t"): 11, 
        (11, "u"): 11, 
        (11, "v"): 11, 
        (11, "w"): 11, 
        (11, "x"): 11, 
        (11, "y"): 11, 
        (11, "z"): 11,
        (11, "0"): 11, 
        (11, "1"): 11, 
        (11, "2"): 11, 
        (11, "3"): 11, 
        (11, "4"): 11, 
        (11, "5"): 11, 
        (11, "6"): 11, 
        (11, "7"): 11, 
        (11, "8"): 11, 
        (11, "9"): 11,
        (11, "!"): 11, 
        (11, "\""): 11, 
        (11, "#"): 11, 
        (11, "$"): 11, 
        (11, "%"): 11, 
        (11, "&"): 11, 
        (11, "'"): 11, 
        (11, "{"): 11, 
        (11, "}"): 11,
        (11, "*"): 11, 
        (11, "+"): 11, 
        (11, ","): 11, 
        (11, "-"): 11, 
        (11, "."): 11, 
        (11, "/"): 11, 
        (11, ":"): 11, 
        (11, ";"): 11, 
        (11, "<"): 11, 
        (11, "="): 11, 
        (11, ">"): 11, 
        (11, "?"): 11, 
        (11, "@"): 11, 
        (11, "["): 11, 
        (11, "\\"): 11, 
        (11, "]"): 11, 
        (11, "^"): 11, 
        (11, "_"): 11, 
        (11, "`"): 11, 
        (11, "|"): 11, 
        (11, "~"): 11,
        (11, " "): 11, 
        (11, "\n"): 11,
        (11, '\t'): 11,
        (11, ")"): 27,
        
        #While loop
        (1, 'w'): 12,
        (12, 'h'): 13,
        (13, 'i'): 14,
        (14, 'l'): 15,
        (15, 'e'): 16,
        (16, ' '): 16, 
        (16, '\n'): 16,
        (16, '\t'): 16,
        (16, '('): 17,
        (17, "A"): 17, 
        (17, "B"): 17, 
        (17, "C"): 17, 
        (17, "D"): 17, 
        (17, "E"): 17, 
        (17, "F"): 17, 
        (17, "G"): 17, 
        (17, "H"): 17, 
        (17, "I"): 17,
        (17, "J"): 17, 
        (17, "K"): 17, 
        (17, "L"): 17, 
        (17, "M"): 17, 
        (17, "N"): 17, 
        (17, "O"): 17, 
        (17, "P"): 17, 
        (17, "Q"): 17, 
        (17, "R"): 17,
        (17, "S"): 17, 
        (17, "T"): 17, 
        (17, "U"): 17, 
        (17, "V"): 17, 
        (17, "W"): 17, 
        (17, "X"): 17, 
        (17, "Y"): 17, 
        (17, "Z"): 17,
        (17, "a"): 17, 
        (17, "b"): 17, 
        (17, "c"): 17, 
        (17, "d"): 17, 
        (17, "e"): 17, 
        (17, "f"): 17, 
        (17, "g"): 17, 
        (17, "h"): 17, 
        (17, "i"): 17,
        (17, "j"): 17, 
        (17, "k"): 17, 
        (17, "l"): 17, 
        (17, "m"): 17, 
        (17, "n"): 17, 
        (17, "o"): 17, 
        (17, "p"): 17, 
        (17, "q"): 17, 
        (17, "r"): 17,
        (17, "s"): 17, 
        (17, "t"): 17, 
        (17, "u"): 17, 
        (17, "v"): 17, 
        (17, "w"): 17, 
        (17, "x"): 17, 
        (17, "y"): 17, 
        (17, "z"): 17,
        (17, "0"): 17, 
        (17, "1"): 17, 
        (17, "2"): 17, 
        (17, "3"): 17, 
        (17, "4"): 17, 
        (17, "5"): 17, 
        (17, "6"): 17, 
        (17, "7"): 17, 
        (17, "8"): 17, 
        (17, "9"): 17,
        (17, "!"): 17, 
        (17, "\""): 17, 
        (17, "#"): 17, 
        (17, "$"): 17, 
        (17, "%"): 17, 
        (17, "&"): 17, 
        (17, "'"): 17, 
        (17, "{"): 17, 
        (17, "}"): 17,
        (17, "*"): 17, 
        (17, "+"): 17, 
        (17, ","): 17, 
        (17, "-"): 17, 
        (17, "."): 17, 
        (17, "/"): 17, 
        (17, ":"): 17, 
        (17, ";"): 17, 
        (17, "<"): 17, 
        (17, "="): 17, 
        (17, ">"): 17, 
        (17, "?"): 17, 
        (17, "@"): 17, 
        (17, "["): 17, 
        (17, "\\"): 17, 
        (17, "]"): 17, 
        (17, "^"): 17, 
        (17, "_"): 17, 
        (17, "`"): 17, 
        (17, "|"): 17, 
        (17, "~"): 17,
        (17, " "): 17, 
        (17, "\n"): 17,
        (17, '\t'): 17,
        (17, ')'): 18,
        (18, ' '): 18, 
        (18, '\n'): 18,
        (18, '\t'): 18,
        (18, '{'): 19,
        (19, '}'): 27,
        (19, "A"): 19, 
        (19, "B"): 19, 
        (19, "C"): 19, 
        (19, "D"): 19, 
        (19, "E"): 19, 
        (19, "F"): 19, 
        (19, "G"): 19, 
        (19, "H"): 19, 
        (19, "I"): 19,
        (19, "J"): 19, 
        (19, "K"): 19, 
        (19, "L"): 19, 
        (19, "M"): 19, 
        (19, "N"): 19, 
        (19, "O"): 19, 
        (19, "P"): 19, 
        (19, "Q"): 19, 
        (19, "R"): 19,
        (19, "S"): 19, 
        (19, "T"): 19, 
        (19, "U"): 19, 
        (19, "V"): 19, 
        (19, "W"): 19, 
        (19, "X"): 19, 
        (19, "Y"): 19, 
        (19, "Z"): 19,
        (19, "a"): 19, 
        (19, "b"): 19, 
        (19, "c"): 19, 
        (19, "d"): 19, 
        (19, "e"): 19, 
        (19, "f"): 19, 
        (19, "g"): 19, 
        (19, "h"): 19, 
        (19, "i"): 19,
        (19, "j"): 19, 
        (19, "k"): 19, 
        (19, "l"): 19, 
        (19, "m"): 19, 
        (19, "n"): 19, 
        (19, "o"): 19, 
        (19, "p"): 19, 
        (19, "q"): 19, 
        (19, "r"): 19,
        (19, "s"): 19, 
        (19, "t"): 19, 
        (19, "u"): 19, 
        (19, "v"): 19, 
        (19, "w"): 19, 
        (19, "x"): 19, 
        (19, "y"): 19, 
        (19, "z"): 19,
        (19, "0"): 19, 
        (19, "1"): 19, 
        (19, "2"): 19, 
        (19, "3"): 19, 
        (19, "4"): 19, 
        (19, "5"): 19, 
        (19, "6"): 19, 
        (19, "7"): 19, 
        (19, "8"): 19, 
        (19, "9"): 19,
        (19, "!"): 19, 
        (19, "\""): 19, 
        (19, "#"): 19, 
        (19, "$"): 19, 
        (19, "%"): 19, 
        (19, "&"): 19, 
        (19, "'"): 19, 
        (19, "("): 19, 
        (19, ")"): 19,
        (19, "*"): 19, 
        (19, "+"): 19, 
        (19, ","): 19, 
        (19, "-"): 19, 
        (19, "."): 19, 
        (19, "/"): 19, 
        (19, ":"): 19, 
        (19, ";"): 19, 
        (19, "<"): 19, 
        (19, "="): 19, 
        (19, ">"): 19, 
        (19, "?"): 19, 
        (19, "@"): 19, 
        (19, "["): 19, 
        (19, "\\"): 19, 
        (19, "]"): 19, 
        (19, "^"): 19, 
        (19, "_"): 19, 
        (19, "`"): 19, 
        (19, "|"): 19, 
        (19, "~"): 19,
        (19, " "): 19, 
        (19, "\n"): 19,
        (19, '\t'): 19,
        
        #For loop
        (1, 'f'): 20,
        (20, 'o'): 21,
        (21, 'r'): 22,
        (22, " "): 22, 
        (22, "\n"): 22,
        (22, '\t'): 22,
        (22, '('): 23,
        (23, "A"): 23, 
        (23, "B"): 23, 
        (23, "C"): 23, 
        (23, "D"): 23, 
        (23, "E"): 23, 
        (23, "F"): 23, 
        (23, "G"): 23, 
        (23, "H"): 23, 
        (23, "I"): 23,
        (23, "J"): 23, 
        (23, "K"): 23, 
        (23, "L"): 23, 
        (23, "M"): 23, 
        (23, "N"): 23, 
        (23, "O"): 23, 
        (23, "P"): 23, 
        (23, "Q"): 23, 
        (23, "R"): 23,
        (23, "S"): 23, 
        (23, "T"): 23, 
        (23, "U"): 23, 
        (23, "V"): 23, 
        (23, "W"): 23, 
        (23, "X"): 23, 
        (23, "Y"): 23, 
        (23, "Z"): 23,
        (23, "a"): 23, 
        (23, "b"): 23, 
        (23, "c"): 23, 
        (23, "d"): 23, 
        (23, "e"): 23, 
        (23, "f"): 23, 
        (23, "g"): 23, 
        (23, "h"): 23, 
        (23, "i"): 23,
        (23, "j"): 23, 
        (23, "k"): 23, 
        (23, "l"): 23, 
        (23, "m"): 23, 
        (23, "n"): 23, 
        (23, "o"): 23, 
        (23, "p"): 23, 
        (23, "q"): 23, 
        (23, "r"): 23,
        (23, "s"): 23, 
        (23, "t"): 23, 
        (23, "u"): 23, 
        (23, "v"): 23, 
        (23, "w"): 23, 
        (23, "x"): 23, 
        (23, "y"): 23, 
        (23, "z"): 23,
        (23, "0"): 23, 
        (23, "1"): 23, 
        (23, "2"): 23, 
        (23, "3"): 23, 
        (23, "4"): 23, 
        (23, "5"): 23, 
        (23, "6"): 23, 
        (23, "7"): 23, 
        (23, "8"): 23, 
        (23, "9"): 23,
        (23, "!"): 23, 
        (23, "\""): 23, 
        (23, "#"): 23, 
        (23, "$"): 23, 
        (23, "%"): 23, 
        (23, "&"): 23, 
        (23, "'"): 23, 
        (23, "{"): 23, 
        (23, "}"): 23,
        (23, "*"): 23, 
        (23, "+"): 23, 
        (23, ","): 23, 
        (23, "-"): 23, 
        (23, "."): 23, 
        (23, "/"): 23, 
        (23, "<"): 23, 
        (23, "="): 23, 
        (23, ">"): 23, 
        (23, "?"): 23, 
        (23, "@"): 23, 
        (23, "["): 23, 
        (23, "\\"): 23, 
        (23, "]"): 23, 
        (23, "^"): 23, 
        (23, "_"): 23, 
        (23, "`"): 23, 
        (23, "|"): 23, 
        (23, "~"): 23,
        (23, " "): 23, 
        (23, "\n"): 23,
        (23, '\t'): 23,
        (23, ';'): 24,
        (24, "A"): 24, 
        (24, "B"): 24, 
        (24, "C"): 24, 
        (24, "D"): 24, 
        (24, "E"): 24, 
        (24, "F"): 24, 
        (24, "G"): 24, 
        (24, "H"): 24, 
        (24, "I"): 24,
        (24, "J"): 24, 
        (24, "K"): 24, 
        (24, "L"): 24, 
        (24, "M"): 24, 
        (24, "N"): 24, 
        (24, "O"): 24, 
        (24, "P"): 24, 
        (24, "Q"): 24, 
        (24, "R"): 24,
        (24, "S"): 24, 
        (24, "T"): 24, 
        (24, "U"): 24, 
        (24, "V"): 24, 
        (24, "W"): 24, 
        (24, "X"): 24, 
        (24, "Y"): 24, 
        (24, "Z"): 24,
        (24, "a"): 24, 
        (24, "b"): 24, 
        (24, "c"): 24, 
        (24, "d"): 24, 
        (24, "e"): 24, 
        (24, "f"): 24, 
        (24, "g"): 24, 
        (24, "h"): 24, 
        (24, "i"): 24,
        (24, "j"): 24, 
        (24, "k"): 24, 
        (24, "l"): 24, 
        (24, "m"): 24, 
        (24, "n"): 24, 
        (24, "o"): 24, 
        (24, "p"): 24, 
        (24, "q"): 24, 
        (24, "r"): 24,
        (24, "s"): 24, 
        (24, "t"): 24, 
        (24, "u"): 24, 
        (24, "v"): 24, 
        (24, "w"): 24, 
        (24, "x"): 24, 
        (24, "y"): 24, 
        (24, "z"): 24,
        (24, "0"): 24, 
        (24, "1"): 24, 
        (24, "2"): 24, 
        (24, "3"): 24, 
        (24, "4"): 24, 
        (24, "5"): 24, 
        (24, "6"): 24, 
        (24, "7"): 24, 
        (24, "8"): 24, 
        (24, "9"): 24,
        (24, "!"): 24, 
        (24, "\""): 24, 
        (24, "#"): 24, 
        (24, "$"): 24, 
        (24, "%"): 24, 
        (24, "&"): 24, 
        (24, "'"): 24, 
        (24, "{"): 24, 
        (24, "}"): 24,
        (24, "*"): 24, 
        (24, "+"): 24, 
        (24, ","): 24, 
        (24, "-"): 24, 
        (24, "."): 24, 
        (24, "/"): 24, 
        (24, ":"): 24, 
        (24, "<"): 24, 
        (24, "="): 24, 
        (24, ">"): 24, 
        (24, "?"): 24, 
        (24, "@"): 24, 
        (24, "["): 24, 
        (24, "\\"): 24, 
        (24, "]"): 24, 
        (24, "^"): 24, 
        (24, "_"): 24, 
        (24, "`"): 24, 
        (24, "|"): 24, 
        (24, "~"): 24,
        (24, " "): 24, 
        (24, "\n"): 24,
        (24, '\t'): 24,
        (23, ':'): 25,
        (24, ';'): 25,
        (25, "A"): 25, 
        (25, "B"): 25, 
        (25, "C"): 25, 
        (25, "D"): 25, 
        (25, "E"): 25, 
        (25, "F"): 25, 
        (25, "G"): 25, 
        (25, "H"): 25, 
        (25, "I"): 25,
        (25, "J"): 25, 
        (25, "K"): 25, 
        (25, "L"): 25, 
        (25, "M"): 25, 
        (25, "N"): 25, 
        (25, "O"): 25, 
        (25, "P"): 25, 
        (25, "Q"): 25, 
        (25, "R"): 25,
        (25, "S"): 25, 
        (25, "T"): 25, 
        (25, "U"): 25, 
        (25, "V"): 25, 
        (25, "W"): 25, 
        (25, "X"): 25, 
        (25, "Y"): 25, 
        (25, "Z"): 25,
        (25, "a"): 25, 
        (25, "b"): 25, 
        (25, "c"): 25, 
        (25, "d"): 25, 
        (25, "e"): 25, 
        (25, "f"): 25, 
        (25, "g"): 25, 
        (25, "h"): 25, 
        (25, "i"): 25,
        (25, "j"): 25, 
        (25, "k"): 25, 
        (25, "l"): 25, 
        (25, "m"): 25, 
        (25, "n"): 25, 
        (25, "o"): 25, 
        (25, "p"): 25, 
        (25, "q"): 25, 
        (25, "r"): 25,
        (25, "s"): 25, 
        (25, "t"): 25, 
        (25, "u"): 25, 
        (25, "v"): 25, 
        (25, "w"): 25, 
        (25, "x"): 25, 
        (25, "y"): 25, 
        (25, "z"): 25,
        (25, "0"): 25, 
        (25, "1"): 25, 
        (25, "2"): 25, 
        (25, "3"): 25, 
        (25, "4"): 25, 
        (25, "5"): 25, 
        (25, "6"): 25, 
        (25, "7"): 25, 
        (25, "8"): 25, 
        (25, "9"): 25,
        (25, "!"): 25, 
        (25, "\""): 25, 
        (25, "#"): 25, 
        (25, "$"): 25, 
        (25, "%"): 25, 
        (25, "&"): 25, 
        (25, "'"): 25, 
        (25, "{"): 25, 
        (25, "}"): 25,
        (25, "*"): 25, 
        (25, "+"): 25, 
        (25, ","): 25, 
        (25, "-"): 25, 
        (25, "."): 25, 
        (25, "/"): 25, 
        (25, ":"): 25, 
        (25, ";"): 25, 
        (25, "<"): 25, 
        (25, "="): 25, 
        (25, ">"): 25, 
        (25, "?"): 25, 
        (25, "@"): 25, 
        (25, "["): 25, 
        (25, "\\"): 25, 
        (25, "]"): 25, 
        (25, "^"): 25, 
        (25, "_"): 25, 
        (25, "`"): 25, 
        (25, "|"): 25, 
        (25, "~"): 25,
        (25, " "): 25, 
        (25, "\n"): 25,
        (25, '\t'): 25,
        (25, ')'): 26,
        (26, "\n"): 26,
        (26, '\t'): 26,
        (26, ' '): 26,
        (26, '{'): 19,
    } 
    startState = 1
    acceptStates = {27}
    afd = AFD(states, alphabet, transitions, startState, acceptStates)
    text = content
    if (extension == "xlsx" or extension == "csv"):
        occurrences = reportOccurrencesTable(afd, text)
    else:
        occurrences = reportOccurrences(afd, text)
    return occurrences